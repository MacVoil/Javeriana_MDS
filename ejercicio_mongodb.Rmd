---
title: "Untitled"
author: "Camilo Vega"
date: "2023-04-18"
output: pdf_document
---

```{r}

```

#Punto A
```{bash eval=FALSE}
use university

db.carreras.aggregate([
  {
    $match:
      /**
       * query: The query in MQL.
       */
      {
        nombre: "Ingenier√≠a de Sistemas",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$cursos",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        curso: "$cursos.curso",
      },
  },
  {
    $lookup:
      /**
       * from: The target collection.
       * localField: The local join field.
       * foreignField: The target join field.
       * as: The name for the results.
       * pipeline: Optional pipeline to run on the foreign collection.
       * let: Optional variables to use in the pipeline field stages.
       */
      {
        from: "cursos",
        localField: "curso",
        foreignField: "_id",
        as: "curso",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$curso",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $lookup:
      /**
       * from: The target collection.
       * localField: The local join field.
       * foreignField: The target join field.
       * as: The name for the results.
       * pipeline: Optional pipeline to run on the foreign collection.
       * let: Optional variables to use in the pipeline field stages.
       */
      {
        from: "profesores",
        localField: "curso.profesor",
        foreignField: "_id",
        as: "profesor",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$profesor",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        _id: 0,
        curso: "$curso.nombre",
        profesor: "$profesor.nombre",
        salon: {
          $concat: [
            {
              $arrayElemAt: [
                "$curso.calendario.salon",
                0,
              ],
            },
            " - Edificio: ",
            {
              $arrayElemAt: [
                "$curso.calendario.edificio",
                0,
              ],
            },
          ],
        },
        dias: "$curso.calendario.dia",
        horario: {
          $concat: [
            {
              $arrayElemAt: [
                "$curso.calendario.inicio",
                0,
              ],
            },
            " - Edificio: ",
            {
              $arrayElemAt: [
                "$curso.calendario.fin",
                0,
              ],
            },
          ],
        },
      },
  },
  {
    $group:
      /**
       * _id: The id of the group.
       * fieldN: The first field name.
       */
      {
        _id: "$curso",
        grupos: {
          $push: "$$ROOT",
        },
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        _id: 0,
        curso: "$_id",
        grupos: {
          $map: {
            input: "$grupos",
            as: "grupo",
            in: {
              profesor: "$$grupo.profesor",
              salon: "$$grupo.salon",
              dias: "$$grupo.dias",
              horario: "$$grupo.horario",
            },
          },
        },
      },
  },
])
```


# Punto B

```{bash eval=FALSE}
use university

db.carreras.aggregate([
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$cursos",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        _id: 0,
        carrera: "$nombre",
        id_curso: "$cursos.curso",
      },
  },
  {
    $lookup:
      /**
       * from: The target collection.
       * localField: The local join field.
       * foreignField: The target join field.
       * as: The name for the results.
       * pipeline: Optional pipeline to run on the foreign collection.
       * let: Optional variables to use in the pipeline field stages.
       */
      {
        from: "cursos",
        localField: "id_curso",
        foreignField: "_id",
        as: "curso",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$curso",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        _id: 0,
        carrera: "$carrera",
        curso: "$curso.nombre",
        id_profesor: "$curso.profesor",
      },
  },
  {
    $lookup:
      /**
       * from: The target collection.
       * localField: The local join field.
       * foreignField: The target join field.
       * as: The name for the results.
       * pipeline: Optional pipeline to run on the foreign collection.
       * let: Optional variables to use in the pipeline field stages.
       */
      {
        from: "profesores",
        localField: "id_profesor",
        foreignField: "_id",
        as: "profesor",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$profesor",
        preserveNullAndEmptyArrays: false,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        profesor: "$profesor.nombre",
        carrera: "$carrera",
        curso: "$curso",
      },
  },
  {
    $group:
      /**
       * _id: The id of the group.
       * fieldN: The first field name.
       */
      {
        _id: {
          profesor: "$profesor",
          carrera: "$carrera",
        },
        cursos: {
          $addToSet: "$curso",
        },
      },
  },
  {
    $group:
      /**
       * _id: The id of the group.
       * fieldN: The first field name.
       */
      {
        _id: "$_id.profesor",
        carreras_cursos: {
          $addToSet: {
            carrera: "$_id.carrera",
            cursos: "$cursos",
          },
        },
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        _id: 0,
        profesor: "$_id",
        careras_cursos: "$carreras_cursos",
      },
  },
  {
    $match:
      /**
       * query: The query in MQL.
       */
      {
        $expr: {
          $eq: [
            {
              $size: "$careras_cursos",
            },
            2,
          ],
        },
      },
  },
])
```

# punto c
```{bash eval=FALSE}
use university

db.estudiantes.aggregate([
  {
    $match:
      /**
       * query: The query in MQL.
       */
      {
        nombre: "Olive Stone",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$carreras",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $lookup:
      /**
       * from: The target collection.
       * localField: The local join field.
       * foreignField: The target join field.
       * as: The name for the results.
       * pipeline: Optional pipeline to run on the foreign collection.
       * let: Optional variables to use in the pipeline field stages.
       */
      {
        from: "carreras",
        localField: "carreras",
        foreignField: "_id",
        as: "carreras",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$carreras",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        _id: 0,
        estudiante: "$nombre",
        carrera: "$carreras.nombre",
        semestre: "$semestre",
        cursos_carrera: "$carreras.cursos",
        cursos_inscritos: "$cursos",
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        carrera: "$carrera",
        cursos_carrera: {
          $filter: {
            input: "$cursos_carrera",
            as: "curso",
            cond: {
              $and: [
                {
                  $lte: [
                    "$$curso.semestre",
                    "$semestre",
                  ],
                },
                {
                  $not: {
                    $in: [
                      "$$curso.curso",
                      "$cursos_inscritos",
                    ],
                  },
                },
              ],
            },
          },
        },
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$cursos_carrera",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        carrera: "$carrera",
        semestre: "$cursos_carrera.semestre",
        id_curso: "$cursos_carrera.curso",
      },
  },
  {
    $lookup:
      /**
       * from: The target collection.
       * localField: The local join field.
       * foreignField: The target join field.
       * as: The name for the results.
       * pipeline: Optional pipeline to run on the foreign collection.
       * let: Optional variables to use in the pipeline field stages.
       */
      {
        from: "cursos",
        localField: "id_curso",
        foreignField: "_id",
        as: "curso",
      },
  },
  {
    $unwind:
      /**
       * path: Path to the array field.
       * includeArrayIndex: Optional name for index.
       * preserveNullAndEmptyArrays: Optional
       *   toggle to unwind null and empty values.
       */
      {
        path: "$curso",
        preserveNullAndEmptyArrays: true,
      },
  },
  {
    $project:
      /**
       * specifications: The fields to
       *   include or exclude.
       */
      {
        curso: "$curso.nombre",
        carrera: "$carrera",
        semestre: "$semestre",
      },
  },
])
```

